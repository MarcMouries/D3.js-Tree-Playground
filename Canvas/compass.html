<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>CodePen - Compass</title>
  <script type="text/javascript" src="trigo.js"></script>
  <script type="text/javascript" src="compass.js"></script>
  <script type="text/javascript" src="MCanvas.js"></script>

  <style>
    html,
    body {
      margin: 5px;
      width: 100%;
      height: 100%;

      background: darkgray;

    }

    #canvas_container {
      width: 100%;
      height: 100%;
      background: white;
    }

    canvas {
      _border: solid 2px red;
    }
  </style>
</head>

<body>
  <div id="canvas_container"></div>
</body>
<script>
  console.clear();
  // =============================================================
  //                          MISC FUNCTIONS
  // =============================================================

  function log(msg) {
    if (false) {
      console.log(msg);
    }
  }

  // =============================================================
  //                          TEST
  // =============================================================

  var modes = ["FULL"]; //, "HALF_NORTH", "HALF_EAST", "HALF_SOUTH", "HALF_WEST"];
  //"SOUTH_EAST", "SOUTH_WEST", "NORTH_WEST"];

  //  ("FULL: 0 - 90 point:0째 350, 200");
  //  ("FULL: 90 - 180 point:90째 200, 350");
  //  ("FULL: 180 - 270 point:180째 50, 200");
  //  ("FULL: 270 - 360 point:270째 200, 50");

  /*
  var p1 = { x: 350, y: 200 };
  //compass.drawPoint(p1.x, p1.y, 20, "p1");
  var p2 = { x: 200, y: 350 };
  //compass.drawPoint(p2.x, p2.y, 20, "p2");
  var p3 = { x: 50, y: 200 };
  //compass.drawPoint(p3.x, p3.y, 20, "p3");
  var p4 = { x: 200, y: 50 };
  //compass.drawPoint(p4.x, p4.y, 20, "p4");
  //console.log("p1: "+compass.getBearing(p1));
  //console.log("p2: "+compass.getBearing(p2));
  //console.log("p3: "+compass.getBearing(p3));
  //console.log("p4: "+compass.getBearing(p4));
  
  var points = [p1, p2, p3, p4];
  
  for (var i = 0; i < points.length; i++) {
    var p = points[i];
  
    var canvas_id = "canvas" + i;
    var canvas = document.createElement("canvas");
    document.body.appendChild(canvas);
    canvas.width = 400;
    canvas.height = 400;
    var cx = canvas.width / 2;
    var cy = canvas.height / 2;
    var compass = new Compass({
      canvas: canvas,
      cx: cx,
      cy: cy,
      radius: circle_radius,
      bearing_point: p
    });
  
    compass.drawPoint(p.x, p.y, 20, "p");
  
    //  compass.setNumberOfPointsAroundArc()
    compass.draw();
    }
  */

  var circle_radius = 100;

  var canvas_container = document.getElementById("canvas_container");
  var mcanvas = new MCanvas({ container: canvas_container });
  var center = mcanvas.getCenter();


  console.log("COMPASS - Center = " + center.x + "x" + center.y);
  var bp_angle = 90; // In degrees
  var bp_radius = 200;
  var bearing_point = getPointOnArc(center, bp_radius, to_radians(bp_angle));
  var bearing_point = center;
  var compass = new Compass({
    center: center,
    radius: circle_radius,
    bearing_point: { x: bearing_point.x, y: bearing_point.y }
  });
  var node_list = [];
  node_list.push(
    { name: "A" },
    { name: "B" },
    { name: "C" },
    { name: "D" }
  );
  compass.setObjectList({ object_list: node_list });

  // Test Animation _________________________________________
  function turn_and_draw() {
    mcanvas.clear();
    // REFERENCE POINT bearing_point.angle_middle
    //  var bearing_point = center;//getPointOnArc(center, bp_radius, to_radians(bp_angle));
    var bearing_point = getPointOnArc(center, bp_radius, to_radians(bp_angle));
    compass.setBearingPoint(bearing_point);
    mcanvas.drawPoint(bearing_point.x, bearing_point.y, 20, bp_angle);
    // The RING
    mcanvas.drawArc(center, 100, 0, 2 * Math.PI, "grey", "white");
    // The ARCs
    compass.calculateOrientation();
    var number_of_points = node_list.length;
    for (var i = 0; i < number_of_points; i++) {
      var point = this.node_list[i];

      mcanvas.drawArc(
        center,
        circle_radius,
        to_radians(point.angle_start),
        to_radians(point.angle_end),
        COLORS[i],
        COLORS[i]);

      // Line
      mcanvas.drawLine(center.x, center.y, point.x, point.y, "black", 1);
      // Point
      mcanvas.drawPoint(point.x, point.y, 20, point.name);
      // Text

    }
    bp_angle = (bp_angle + 1) % 360;
  }
  turn_and_draw();

  // Animation Logic ________________________________________
  setInterval(function () {
  //  turn_and_draw();
  }, 1000);
</script>

</html>